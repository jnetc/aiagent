<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= title %>
  </title>
  <link rel="stylesheet" href="/static/css/global.css">
  <link rel="stylesheet" href="/static/css/analytics.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="/static/js/main.js" defer></script>
  <script src="/static/js/analytics-page.js" defer></script>
</head>

<body data-items-per-page="<%= itemsPerPage %>" data-is-pro="<%= isPro %>"
  data-is-guest="<%= typeof isGuest !== 'undefined' && isGuest %>"
  data-current-filters='<%- JSON.stringify(currentFilters) %>' data-total-cards="<%= total %>">
  <%- include('partials/navigation') %>

  <main class="main-content">
    <!-- Analytics Header -->
    <div class="analytics-header">
      <div class="container">
        <div class="header-content">
          <h1>NFT Analytics Dashboard</h1>
          <% if (typeof isGuest !== 'undefined' && isGuest) { %>
          <p class="guest-notice">Preview mode - <a href="/login">Login</a> for full access</p>
          <% } %>

          <div class="header-stats">
            <div class="stat-item">
              <span class="stat-number"><%= stats.totalProjects.toLocaleString() %></span>
              <span class="stat-label">Projects Tracked</span>
            </div>
            <div class="stat-item">
              <span class="stat-number"><%= stats.trendingToday %></span>
              <span class="stat-label">Trending Today</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">$<%= (stats.totalVolume24h / 1000000).toFixed(1) %>M</span>
              <span class="stat-label">Volume 24h</span>
            </div>
            <div class="stat-item stat-positive">
              <span class="stat-number"><%= stats.topGainer %></span>
              <span class="stat-label">Top Gainer</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <% if (typeof isGuest === 'undefined' || !isGuest) { %>
    <div class="analytics-filters">
      <div class="container">
        <div class="filters-row">
          <div class="filter-group">
            <select class="filter-select" data-filter="platform" id="platform-filter" <% if (!isPro) { %>
              disabled<% } %>>
              <option value="all" <% if (currentFilters.platform === 'all' || !currentFilters.platform) { %>
                selected<% } %>>All Platforms</option>
              <option value="zora" <% if (currentFilters.platform === 'zora') { %> selected<% } %>>Zora</option>
              <option value="foundation" <% if (currentFilters.platform === 'foundation') { %> selected<% } %>>
                Foundation
              </option>
              <option value="superrare" <% if (currentFilters.platform === 'superrare') { %> selected<% } %>>SuperRare
              </option>
              <option value="fxhash" <% if (currentFilters.platform === 'fxhash') { %> selected<% } %>>FxHash</option>
            </select>
            <% if (!isPro) { %>
            <small class="pro-notice">ðŸ”’ Pro feature</small>
            <% } %>
          </div>

          <div class="filter-group">
            <select class="filter-select" data-filter="risk" id="risk-filter" <% if (!isPro) { %> disabled<% } %>>
              <option value="all" <% if (currentFilters.risk === 'all' || !currentFilters.risk) { %> selected<% } %>>All
                Risk Levels</option>
              <option value="low" <% if (currentFilters.risk === 'low') { %> selected<% } %>>Low Risk</option>
              <option value="medium" <% if (currentFilters.risk === 'medium') { %> selected<% } %>>Medium Risk</option>
              <option value="high" <% if (currentFilters.risk === 'high') { %> selected<% } %>>High Risk</option>
            </select>
            <% if (!isPro) { %>
            <small class="pro-notice">ðŸ”’ Pro feature</small>
            <% } %>
          </div>

          <div class="filter-group">
            <select class="filter-select" data-filter="sort" id="sort-filter">
              <option value="trending" <% if (currentFilters.sortBy === 'trending') { %> selected<% } %>>Trending
              </option>
              <option value="volume" <% if (currentFilters.sortBy === 'volume') { %> selected<% } %>>Volume</option>
              <% if (isPro) { %>
              <option value="followers" <% if (currentFilters.sortBy === 'followers') { %> selected<% } %>>Follower
                Growth
              </option>
              <option value="marketcap" <% if (currentFilters.sortBy === 'marketcap') { %> selected<% } %>>Market Cap
              </option>
              <% } %>
            </select>
          </div>

          <% if (isPro) { %>
          <div class="filter-group">
            <div class="toggle-group">
              <input type="checkbox" id="trending-only" class="toggle-input"
                <%= currentFilters.trending ? 'checked' : '' %>>
              <label for="trending-only" class="toggle-label">Trending Only</label>
            </div>
          </div>
          <% } %>

          <div class="filter-group">
            <input type="text" id="search-input" class="search-input" placeholder="Search artists, collections..."
              value="<% if (currentFilters.search) { %><%= currentFilters.search %><% } %>" <% if (!isPro) { %>
              disabled<% } %>>
            <button id="search-btn" class="btn btn-primary btn-small" <% if (!isPro) { %> disabled<% } %>>
              <i class="fas fa-search"></i>
            </button>
            <% if (!isPro) { %>
            <small class="pro-notice">ðŸ”’ Pro feature</small>
            <% } %>
          </div>

          <% if (isPro) { %>
          <div class="filter-group">
            <button id="export-btn" class="btn btn-outline btn-small">
              <i class="fas fa-download"></i> Export CSV
            </button>
          </div>
          <% } %>
        </div>
      </div>
    </div>
    <% } %>

    <!-- Main Content -->
    <div class="analytics-content">
      <div class="container">
        <!-- Banners -->
        <% if (typeof showGuestPrompt !== 'undefined' && showGuestPrompt) { %>
        <div class="guest-banner">
          <div class="upgrade-content">
            <i class="fas fa-eye"></i>
            <div>
              <h3>Preview Mode</h3>
              <p>You're viewing limited data. Create an account to access more analytics and AI insights.</p>
            </div>
            <a href="/login" class="btn btn-primary">Sin Up Free</a>
          </div>
        </div>
        <% } else if (showUpgradePrompt) { %>
        <div class="upgrade-banner">
          <div class="upgrade-content">
            <i class="fas fa-lock"></i>
            <div>
              <h3>Unlock Full Analytics</h3>
              <p>You're viewing limited data. Upgrade to Pro for complete insights, AI recommendations, filtering, and
                real-time tracking.</p>
            </div>
            <a href="/pricing" class="btn btn-primary">Uprade Now</a>
          </div>
        </div>
        <% } %>

        <!-- Platform Statistics -->
        <% if (typeof platformStats !== 'undefined' && platformStats && isPro) { %>
        <div class="platform-stats">
          <h3>Platform Distribution</h3>
          <div class="platform-grid">
            <% Object.entries(platformStats).forEach(([platform, stats]) => { %>
            <div class="platform-stat-card">
              <div class="platform-name">
                <i class="fas fa-cube"></i>
                <%= platform.charAt(0).toUpperCase() + platform.slice(1) %>
              </div>
              <div class="platform-metrics">
                <div class="metric">
                  <span class="value"><%= stats.count %></span>
                  <span class="label">Projects</span>
                </div>
                <div class="metric">
                  <span class="value">$<%= (stats.volume / 1000).toFixed(0) %>K</span>
                  <span class="label">Volume</span>
                </div>
                <div class="metric">
                  <span class="value"><%= stats.trending %></span>
                  <span class="label">Trending</span>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
        </div>
        <% } %>

        <!-- Results Summary -->
        <div class="results-summary">
          <div class="results-info">
            <span>Showing <strong><%= cards.length %></strong> of <strong><%= total %></strong> projects</span>
            <% if (currentFilters.search) { %>
            <span>for "<%= currentFilters.search %>"</span>
            <% } %>
            <% if (typeof isGuest !== 'undefined' && isGuest) { %>
            <span class="guest-limit">(Preview: showing 3 of <%= total %>)</span>
            <% } %>
          </div>

          <% if (isPro) { %>
          <div class="view-options">
            <button class="view-btn active" data-view="grid">
              <i class="fas fa-th"></i> Grid
            </button>
            <button class="view-btn" data-view="list">
              <i class="fas fa-list"></i> List
            </button>
          </div>
          <% } %>
        </div>

        <!-- Analytics Cards Grid -->
        <div class="analytics-grid" id="analytics-grid">
          <%- include('partials/analytics-cards', { cards, isPro, isGuest }) %>
        </div>

        <!-- Guest CTA -->
        <% if (typeof isGuest !== 'undefined' && isGuest) { %>
        <div class="guest-cta">
          <div class="cta-content">
            <h3>Want to see more?</h3>
            <p>Create a free account to access:</p>
            <ul>
              <li>âœ“ 5 analytics cards per day</li>
              <li>âœ“ Basic filtering and search</li>
              <li>âœ“ AI recommendations</li>
              <li>âœ“ Twitter integration</li>
            </ul>
            <div class="cta-actions">
              <a href="/login" class="btn btn-primary btn-large">Sign Up Free</a>
              <a href="/pricing" class="btn btn-outline btn-large">View Pro Features</a>
            </div>
          </div>
        </div>
        <% } %>

        <!-- Pagination -->
        <% if (isPro && total > cards.length) { %>
        <div class="pagination-container">
          <div class="pagination">
            <button class="pagination-btn" id="prev-btn" onclick="changePage(-1)">
              <i class="fas fa-chevron-left"></i> Previous
            </button>
            <div class="pagination-info">
              <span>Page <span id="current-page">1</span> of <span
                  id="total-pages"><%= Math.ceil(total / (isPro ? 50 : 5)) %></span></span>
            </div>
            <button class="pagination-btn" id="next-btn" onclick="changePage(1)">
              Next <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
        <% } %>
      </div>
    </div>

    <!-- Success Notification -->
    <% if (locals.upgrade === 'success') { %>
    <div class="notification success">
      <p>ðŸŽ‰ Welcome to Pro! You now have access to full analytics and AI insights.</p>
    </div>
    <% } %>
  </main>

  <%- include('partials/footer') %>
</body>

</html>
